<div class="container-fluid well" style="height: 100%;overflow-y: hidden;position: relative;">
	<div class="form-inline">
		<div class="form-group" id="control-btns">
		</div>
	</div>
	<table id="electronic_list" class="table table-bordered table-striped table-hover table-condensed success" style="width: 100%">
		<thead>
			<td>设备名称</td>
			<td>设备号码</td>
			<td>地址</td>
			<td>修改</td>
			<td>删除</td>
		</thead>
	</table>
	<div id="electronic_module_panel_modal"></div>
</div>

<script>
	electronicManagerTable = function() {
		var table = null;
		var defUrl = ''; // /dongjun/gprs/company_gprs
		var curMonitorId = ''
		return {
			getTable: function(){
				return table;
			},
			init: function(o) {
				panelObserver.regist('showElectronicModule', function(agrs) {
					// console.log(agrs)
					this.setMonitorId(agrs.id).draw()
				}.bind(this))
				if(o.url) {
					defUrl = o.url
				}
			},
			setMonitorId: function(id) {
				curMonitorId = id
				return this
			},
			draw: function(id) {
				var me = this
				table = $('#electronic_list').DataTable({
					'destroy': true,// destroy之后才能重新加载
					'searching': false,
          'ordering':  false,
          'info': false,
          'paging': false,
					'ajax': {
						'url': defUrl,
						'type': 'POST',
						'dataSrc': function(json) {
              json.text = Object.prototype.toString.call(json.text) == '[object Object]' ? [json.text] : []
              return json.text
            },
						'data': {
							'monitorId': curMonitorId
						}
					},
					'columns': [
						{ 'data': 'name' },
						{
							'data': 'deviceNumber',
							'orderable': false
						},
						{
							'data': 'address',
							'orderable': false
						},
						{
							data: 'id',
							width: '50px',
							orderable: false,
							render: function(data, type, row) {
								return '<a href="#edit_electronic_modal" role="button" class="btn" data-toggle="modal" data-fnc="edit"  data-id="'+data+'">修改</a>'
							}
						},
						{
							data: 'id',
							orderable: false,
							width: '50px',
							render: function(data) {
								return '<a role="button" class="btn btn-danger" data-toggle="modal" data-fnc="del" data-id="' + data + '">删除</a>'
							}
						}
					],
					'language': {
						'paginate': {
							'next': '下一页',
							'previous': '上一页'
						},
						'emptyTable': '<a data-fnc="add">添加设备</a>',
            'zeroRecords': '<a data-fnc="add">添加设备</a>',
						'loadingRecords': '正在加载数据...'
					},
					'initComplete': function() {
						dj.inserCmp('electronic_module_modal.html', $('#electronic_module_panel_modal')[0], function() {
							// 设置modal
							electronicModuleModal.init({
								url: {
									add: '/dongjun/data_monitor/submodule/electronic/edit',
									edit: '/dongjun/data_monitor/submodule/electronic/edit',
									del: '/dongjun/data_monitor/submodule/electronic/del'
								},
								complete: me.redraw.bind(me)
							});
						});

						$(this[0]).click(function(event) {
							var target = $(event.target)
							var fnc = target.data('fnc')
							if(fnc == 'edit') {
								var id = target.data('id')
								var data = Array.prototype.find.call(table.data(), function(item) {
									return item.id == id
								})
								electronicModuleModal.edit(data)

							} else if(fnc == 'del') {
								var id = target.data('id')
								electronicModuleModal.del(id)
							} else if(fnc == 'add') {
								electronicModuleModal.add(id)
							}
						})
					}
				})
				this.draw = this.redraw
				return this
			},
			redraw: function(id) {
				table.ajax.url(defUrl);
				var param = {
					monitorId: id || curMonitorId
				};
				table.settings()[0].ajax.data = param;
				table.ajax.reload();
			},
			renderStatus: function(data, type, row) {
				var statusColor = ['#F60E0E', '#03CC00'],
						statusDesc = ['离线', '在线']
				return '<span style="color: ' + statusColor[+data] + '">'+ statusDesc[+data] +'</span>'
			},
			renderAvailable: function(data) {
				data = data ? 1 : 0
				var statusColor = ['#F60E0E', '#03CC00'],
						statusDesc = ['未开启', '已开启']
				return '<span style="color: ' + statusColor[data] + '">'+ statusDesc[data] +'</span>'
			}
		}
	}()

	electronicManagerTable.init({
		url: '/dongjun/gprs/list', // /dongjun/gprs/list
		data: {
			platformId: $('.platforms').val()
		}
	})

</script>